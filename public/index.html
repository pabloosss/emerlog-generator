<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Generator Godzin Rmsped</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container mt-4">
    <h1>Generator Godzin Rmsped</h1>
    <form id="generatorForm">
      <div class="mb-3">
        <label for="name" class="form-label">Imię i nazwisko:</label>
        <input type="text" class="form-control" id="name" required>
      </div>
      <div class="mb-3">
        <label for="month" class="form-label">Miesiąc (1-12):</label>
        <input type="number" class="form-control" id="month" min="1" max="12" required>
      </div>
      <div class="mb-3">
        <label for="year" class="form-label">Rok:</label>
        <input type="number" class="form-control" id="year" value="2025" required>
      </div>
      <button type="submit" class="btn btn-primary">Generuj tabelę</button>
    </form>

    <div id="output" class="mt-4"></div>
    <button id="generatePDF" class="btn btn-success mt-3" style="display:none">Pobierz PDF</button>
  </div>

  <script>
    document.getElementById("generatorForm").addEventListener("submit", function (e) {
      e.preventDefault();
      generateTable();
    });

    function generateTable() {
      const name = document.getElementById("name").value;
      const month = parseInt(document.getElementById("month").value);
      const year = parseInt(document.getElementById("year").value);

      if (!name || !month || !year) {
        alert("Uzupełnij wszystkie pola!");
        return;
      }

      const daysInMonth = new Date(year, month, 0).getDate();
      let rows = "";
      for (let i = 1; i <= daysInMonth; i++) {
        const date = new Date(year, month - 1, i);
        const weekday = date.toLocaleString("pl-PL", { weekday: "short" });
        rows += `<tr><td>${i}</td><td>${date.toLocaleDateString()}</td><td>08:00</td><td>16:00</td><td>8</td><td>${name}</td><td></td></tr>`;
      }

      const html = `
        <table class="table table-bordered mt-3">
          <thead>
            <tr><th>Dzień</th><th>Data</th><th>Początek</th><th>Koniec</th><th>Godzin</th><th>Podpis</th><th>Zleceniodawca</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;

      document.getElementById("output").innerHTML = html;
      document.getElementById("generatePDF").style.display = "inline-block";
    }

    document.getElementById("generatePDF").addEventListener("click", async () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      const output = document.getElementById("output");

      const canvas = await html2canvas(output);
      const imgData = canvas.toDataURL("image/png");
      const imgProps = pdf.getImageProperties(imgData);
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

      pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
      pdf.save("harmonogram.pdf");
    });
  </script>
</body>
</html>
