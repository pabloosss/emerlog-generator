<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<title>Generator Godzin Emerlog</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
<style>
:root{
  --ink:#111; --muted:#555; --grid:#000;
  --off-bg:#ffcccc; --off-ink:#a00;
  --thead-bg:#fff; --paper:#fff;
}
html,body{background:#f5f5f7;color:var(--ink)}
.container{max-width:1040px}
header{background:#fff;border-bottom:1px solid #e5e7eb}
.brand{font-weight:700}

.card{border:1px solid #e5e7eb;border-radius:12px}
.card-header{background:#fff;border-bottom:1px solid #e5e7eb;font-weight:600}

/* ————— TABELA (jak na podglądzie) ————— */
.sheet-wrap{background:var(--paper);border:1px solid var(--grid);border-radius:10px;overflow:hidden}
.sheet-head{padding:16px 18px 8px 18px;border-bottom:1px solid var(--grid)}
.sheet-head .mname{font-size:24px;font-weight:800;margin:0}
.sheet-head .person{font-size:18px;font-weight:700;margin:2px 0 0}
.sheet-head .ctype{font-size:12px;color:var(--muted);margin:0}

.table-times{
  width:100%;
  border-collapse:collapse;
  table-layout:fixed;
  background:var(--paper);
}
.table-times th,.table-times td{
  border:1px solid var(--grid);
  padding:8px 10px;
  text-align:center;
  vertical-align:middle;
  background:#fff;
  font-size:14px;
}
.table-times thead th{background:var(--thead-bg);font-weight:700;}
.table-times .col-day{width:54px}
.table-times .col-date{text-align:left}
.table-times .col-start,.table-times .col-end{width:100px}
.table-times .col-hours{width:90px}
.table-times .col-sign{width:140px}
.table-times .col-leave{width:110px}
.mono{font-variant-numeric:tabular-nums}
.table-times tr.off td{background:var(--off-bg);color:var(--off-ink);font-weight:700;}
.table-times tfoot td{font-weight:800;background:#fff;}
@media print{body{background:#fff}.card,.sheet-wrap{box-shadow:none}*{-webkit-print-color-adjust:exact;print-color-adjust:exact}}
</style>
</head>
<body>
<header>
  <div class="container py-3 d-flex justify-content-between align-items-center">
    <div class="brand h5 m-0"><i class="fas fa-clock me-2 text-primary"></i>Generator Godzin Emerlog</div>
  </div>
</header>

<main class="container py-4">
  <section class="card mb-4">
    <div class="card-header py-3 px-4">Parametry</div>
    <div class="card-body p-4">
      <form id="generatorForm" novalidate>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label" for="name">Imię i nazwisko *</label>
            <input class="form-control" id="name" required>
          </div>
          <div class="col-md-3">
            <label class="form-label" for="month">Miesiąc *</label>
            <select class="form-select" id="month" required>
              <option value="">Wybierz…</option>
              <option value="1">Styczeń</option><option value="2">Luty</option><option value="3">Marzec</option>
              <option value="4">Kwiecień</option><option value="5">Maj</option><option value="6">Czerwiec</option>
              <option value="7">Lipiec</option><option value="8">Sierpień</option><option value="9">Wrzesień</option>
              <option value="10">Październik</option><option value="11">Listopad</option><option value="12">Grudzień</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label" for="year">Rok *</label>
            <input class="form-control" type="number" id="year" min="2000" value="2025" required>
          </div>
          <div class="col-md-3">
            <label class="form-label d-block">Rodzaj umowy</label>
            <div class="form-check"><input class="form-check-input" type="radio" name="contractType" id="zlec" value="zlecenie" checked><label class="form-check-label" for="zlec">Umowa zlecenie</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="contractType" id="pelny" value="praca"><label class="form-check-label" for="pelny">Umowa o pracę</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="contractType" id="trzyczw" value="praca3/4"><label class="form-check-label" for="trzyczw">Umowa o pracę (3/4 etatu)</label></div>
          </div>
        </div>
        <hr class="my-4">
        <div class="row g-3 align-items-end">
          <div class="col-md-6" id="hoursGroup">
            <label class="form-label" for="hours">Łączna liczba godzin (zlecenie) *</label>
            <input class="form-control" type="number" id="hours" min="30" step="1">
            <div class="form-check mt-2"><input class="form-check-input" type="checkbox" id="randomHolidays"><label class="form-check-label" for="randomHolidays">Losowe dni wolne (~35%)</label></div>
          </div>
        </div>
        <div class="mt-4 d-flex gap-2">
          <button class="btn btn-primary" type="submit"><i class="fa fa-table me-1"></i>Generuj tabelę</button>
        </div>
      </form>
    </div>
  </section>

  <section class="sheet-wrap" id="resultWrap" style="display:none;">
    <div class="sheet-head">
      <h2 class="mname" id="mname"></h2>
      <p class="person" id="pname"></p>
      <p class="ctype" id="ctype"></p>
    </div>
    <div id="output"></div>
  </section>
</main>

<script>
(()=>{const MIN_START=7,MAX_END=20,MIN_H=4,MAX_H=16;
function ri(a,b){a=Math.ceil(a);b=Math.floor(b);return Math.floor(Math.random()*(b-a+1))+a;}
function toISO(d){return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;}
function isWeekend(d){const w=d.getDay();return w===0||w===6;}
function applyRandomOff(list){
 const idx=list.map((d,i)=>d.isWorkingDay?i:-1).filter(i=>i>=0);
 if(idx.length<3)return;
 let toDrop=Math.max(1,Math.round(idx.length*(0.30+Math.random()*0.10)));
 const picks=new Set();
 while(toDrop>0&&idx.length>0){
   const i=idx.splice(Math.floor(Math.random()*idx.length),1)[0];
   if([...picks].every(p=>Math.abs(p-i)>1)){picks.add(i);toDrop--;}
 }
 for(const i of picks){list[i].isWorkingDay=false;list[i].holidayType="-";}
}
function distribute(total,n,min,max){
 let arr=Array.from({length:n},()=>ri(min,max)),sum=arr.reduce((a,b)=>a+b,0);
 const inc=()=>{const i=arr.findIndex(v=>v<max);if(i>=0){arr[i]++;return true;}return false;};
 const dec=()=>{const i=arr.findIndex(v=>v>min);if(i>=0){arr[i]--;return true;}return false;};
 while(sum<total&&inc())sum++;
 while(sum>total&&dec())sum--;
 return arr;
}
function assignTimes(days,arr){
 let prev=null;
 for(let i=0;i<days.length;i++){
   const h=arr[i];
   let s=ri(7,13);
   if(s+h>20)s=20-h;
   let e=s+h;
   if(prev!==null&&s===prev){if(e<20){s++;e++;}else if(s>7){s--;e--;}}
   days[i].start=(s<10?"0"+s:s)+":00";days[i].end=(e<10?"0"+e:e)+":00";days[i].hours=h;prev=s;
 }
 // jitter
 for(let i=1;i<days.length;i++){
   if(days[i].start===days[i-1].start){let s=parseInt(days[i].start),e=parseInt(days[i].end);if(e<20){s++;e++;}else if(s>7){s--;e--;}
     days[i].start=(s<10?"0"+s:s)+":00";days[i].end=(e<10?"0"+e:e)+":00";}
 }
}
document.getElementById("generatorForm").addEventListener("submit",e=>{
 e.preventDefault();
 const name=document.getElementById("name").value.trim();
 const m=+document.getElementById("month").value;
 const y=+document.getElementById("year").value;
 const total=+document.getElementById("hours").value;
 const rand=document.getElementById("randomHolidays").checked;
 const daysInMonth=new Date(y,m,0).getDate();
 const arr=[];for(let d=1;d<=daysInMonth;d++){const dt=new Date(y,m-1,d);arr.push({day:d,date:dt,isWorkingDay:!isWeekend(dt),holidayType:""});}
 if(rand)applyRandomOff(arr);
 const working=arr.filter(d=>d.isWorkingDay);
 const hoursArr=distribute(total,working.length,MIN_H,MAX_H);
 assignTimes(working,hoursArr);
 const monthName=["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"][m-1];
 document.getElementById("mname").textContent=`${monthName} ${y}`;
 document.getElementById("pname").textContent=name;
 document.getElementById("ctype").textContent="Umowa zlecenie";
 const rows=arr.map(d=>{
   if(!d.isWorkingDay)return `<tr class='off'><td>${d.day}</td><td>${String(d.day).padStart(2,'0')}.${String(m).padStart(2,'0')}.${y}</td><td>-</td><td>-</td><td>0</td><td>${name.split(' ').pop()}</td><td></td><td>-</td></tr>`;
   return `<tr><td>${d.day}</td><td>${String(d.day).padStart(2,'0')}.${String(m).padStart(2,'0')}.${y}</td><td>${d.start}</td><td>${d.end}</td><td>${d.hours}</td><td>${name.split(' ').pop()}</td><td></td><td>-</td></tr>`;
 }).join('');
 const sum=arr.filter(d=>d.isWorkingDay).reduce((a,b)=>a+b.hours,0);
 document.getElementById("output").innerHTML=`<table class='table-times'><thead><tr><th>Dzień</th><th>Data</th><th>Godz. rozpoczęcia</th><th>Godz. zakończenia</th><th>Suma godzin</th><th>Podpis zleceniobiorcy</th><th>Podpis zleceniodawcy</th><th>Urlop</th></tr></thead><tbody>${rows}</tbody><tfoot><tr><td colspan='4'>Suma</td><td>${sum}</td><td colspan='3'></td></tr></tfoot></table>`;
 document.getElementById("resultWrap").style.display="block";
});
})();
</script>
</body>
</html>
