<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Test docx minimal - wysyłanie Worda</title>

  <!-- docx z JSDelivr, jedyny link -->
  <script src="https://cdn.jsdelivr.net/npm/docx@7.7.0/build/index.umd.js"></script>
</head>
<body style="font-family: Arial; max-width: 600px; margin: 20px auto;">
  <h2>Test wysyłania Worda</h2>

  <button id="sendWordBtn" style="padding:10px 20px;">Wyślij Word testowy</button>

  <script>
    document.getElementById("sendWordBtn").addEventListener("click", async () => {
      try {
        // Sprawdź, czy docx jest załadowany
        if (!window.docx || !window.docx.Document) {
          alert("window.docx jest undefined! Sprawdź link do docx");
          return;
        }

        // Rozpakowujemy docx obiekty
        const { Document, Paragraph, Packer } = window.docx;

        // Tworzymy prosty Document:
        const doc = new Document({
          creator: "Test DOCX",
          title: "Plik testowy"
        });

        // Dodajemy jeden prosty paragraf:
        doc.addSection({
          children: [
            new Paragraph("To jest testowy plik Word."),
            new Paragraph("Drugi akapit."),
          ]
        });

        // Tworzymy blob
        const blob = await Packer.toBlob(doc);

        // Konwertujemy na base64
        const reader = new FileReader();
        reader.onloadend = async () => {
          const base64 = reader.result.split(",")[1];

          // Wysyłamy do /send-docx
          try {
            const res = await fetch("/send-docx", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ 
                name: "TestDocx", 
                docxData: base64 
              })
            });

            if (res.ok) {
              alert("Wysłano Word testowy!");
            } else {
              alert("Błąd wysyłki Worda (status: " + res.status + ")");
            }
          } catch (err) {
            console.error("Błąd fetch /send-docx", err);
            alert("Błąd fetch /send-docx. Sprawdź konsolę.");
          }
        };
        reader.readAsDataURL(blob);

      } catch (err) {
        console.error("Błąd w sendWord", err);
        alert("Błąd w sendWord: " + err);
      }
    });
  </script>
</body>
</html>
