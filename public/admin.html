<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Panel Administratora</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
  <div class="container mt-5">
    <div class="text-center">
      <h2>Panel Administratora</h2>
      <button id="adminPanelBtn" class="btn btn-warning mt-3">Zaloguj jako Admin</button>
    </div>
    <div id="output" class="mt-5"></div>
  </div>

  <!-- Modal logowania -->
  <div class="modal" id="adminModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Logowanie Admina</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="text" id="adminLogin" class="form-control mb-2" placeholder="Login">
          <input type="password" id="adminPass" class="form-control mb-2" placeholder="Hasło">
          <button id="loginBtn" class="btn btn-primary">Zaloguj</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById("adminPanelBtn").addEventListener("click", () => {
      const modal = new bootstrap.Modal(document.getElementById("adminModal"));
      modal.show();
    });

    document.getElementById("loginBtn").addEventListener("click", async () => {
      const login = document.getElementById("adminLogin").value.trim();
      const pass = document.getElementById("adminPass").value.trim();

      if (login === "ewa" && pass === "admin") {
        alert("Zalogowano jako admin");
        document.getElementById("adminModal").classList.remove("show");
        document.querySelector(".modal-backdrop")?.remove();
        loadAdminPanel();
      } else {
        alert("Nieprawidłowy login lub hasło");
      }
    });

    async function loadAdminPanel() {
      const res = await fetch("/admin-data");
      const data = await res.json();

      let html = `
        <h3 class="mb-4">Lista użytkowników</h3>
        <form id="addUserForm" class="mb-4">
          <div class="row g-2">
            <div class="col-md-8">
              <input type="text" id="newUserName" class="form-control" placeholder="Imię i nazwisko" required>
            </div>
            <div class="col-md-4">
              <button type="submit" class="btn btn-success w-100">Dodaj użytkownika</button>
            </div>
          </div>
        </form>
        <table class="table table-bordered">
          <thead class="table-light">
            <tr><th>Imię i nazwisko</th><th>Status</th></tr>
          </thead><tbody>`;

      data.forEach(row => {
        html += `<tr><td>${row.name}</td><td>${row.sent ? "Wysłano" : "Nie wysłano"}</td></tr>`;
      });

      html += `</tbody></table>`;
      document.getElementById("output").innerHTML = html;

      document.getElementById("addUserForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("newUserName").value.trim();
        if (!name) return alert("Podaj imię i nazwisko!");
        const res = await fetch("/add-user", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name })
        });
        if (res.ok) {
          alert("Użytkownik dodany!");
          loadAdminPanel();
        } else {
          alert("Błąd przy dodawaniu użytkownika.");
        }
      });
    }
  </script>
</body>
</html>
