<!DOCTYPE html><html lang="pl"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin — Wysłane maile</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head><body class="p-4">
<h3>Admin — Wysłane maile</h3>
<div class="mb-3">
  <label class="form-label">API Key</label>
  <input type="password" id="apiKey" class="form-control" placeholder="Wklej X-API-Key">
</div>
<div class="mb-3">
  <button class="btn btn-primary" id="refresh">Odśwież</button>
  <button class="btn btn-danger" id="clear">Wyczyść wszystkich</button>
</div>
<table class="table table-bordered" id="tbl">
  <thead><tr><th>Imię i nazwisko</th><th>Sent</th><th>SentAt</th><th>Typ</th><th>Akcja</th></tr></thead>
  <tbody></tbody>
</table>
<script>
async function call(path, opts={}){
  const key=document.getElementById("apiKey").value.trim();
  opts.headers=Object.assign({},opts.headers||{},{"X-API-Key":key,"Content-Type":"application/json"});
  const r=await fetch(path,opts); if(!r.ok) throw new Error(await r.text()); return r.json().catch(()=>({}));
}
async function load(){
  const data=await call("/admin-data");
  const tb=document.querySelector("#tbl tbody"); tb.innerHTML="";
  data.forEach(row=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${row.name}</td><td>${row.sent?"✓":""}</td><td>${row.sentAt||""}</td><td>${row.lastType||""}</td>
                  <td><button class="btn btn-sm btn-outline-danger">Usuń</button></td>`;
    tr.querySelector("button").onclick=async()=>{await call("/remove-user",{method:"POST",body:JSON.stringify({id:row.name})});load();};
    tb.appendChild(tr);
  });
}
document.getElementById("refresh").onclick=load;
document.getElementById("clear").onclick=async()=>{await call("/remove-all-users",{method:"POST"});load();};
</script>
</body></html>
